(()=>{var e={610:(e,t,n)=>{"use strict";n.r(t);var r=n(8894),i=n(45),o=n(296),a=n(6665),s=n(4467),l=n(530),u=n(3004),c=n(6793),d=n(6283),f=n(6773),h=n(3929),p=n(6725),m=n(4505),g=n(3259),y=n(397),v=["icon"];function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=function(e){var t=e.icon,n=(0,i.default)(e,v);return"settings"===t?(0,y.jsx)(g.FiSettings,x({},n)):"x"===t?(0,y.jsx)(g.FiX,x({},n)):void 0},j=["children","style"],O=["style","label","labelStyle"];function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E="Arial",k=12,T=14,C=16,A=18,D={primary:"#2D69AF",warning:"#fec514",danger:"#C41818",success:"#4DC418",secondary:"#4DC418",borderColor:"#E2E6F0",backColor:"#F7F7F7",app:"#212121",textPrimary:"#fff",textSecondary:"#6C6C6C"},I=function(e){var t=e.color,n=void 0===t?D.borderColor:t,r=e.width,i=void 0===r?1:r,o=e.style,a={borderBottomWidth:i,borderBottomColor:n};return(0,y.jsx)(z,{style:[o],children:(0,y.jsx)(z,{style:[a]})})},N=function(e){var t=e.style,n=e.children,r={fontSize:A,paddingVertical:5};return(0,y.jsx)(M,{style:[r,t],children:n})},M=function(e){var t=e.children,n=e.style,r=(0,i.default)(e,j),o={fontFamily:E,color:D.textPrimary,fontSize:T};return(0,y.jsx)(d.default,P(P({style:[o,n]},r),{},{children:t}))},_=function(e){var t=e.style,n=e.label,r=e.labelStyle,o=(0,i.default)(e,O),a={padding:10,color:D.textPrimary,borderColor:D.borderColor,borderWidth:1,borderRadius:10,outlineStyle:"none"};return(0,y.jsxs)(z,{style:{paddingVertical:10},children:[n&&(0,y.jsx)(M,{style:[{fontSize:k},r],children:n}),(0,y.jsx)(f.default,P({style:[a,t],placeholderTextColor:D.textSecondary},o))]})},R=function(e){var t=e.size,n=void 0===t?50:t,r=e.source,i=e.onPress,o=e.style;return(0,y.jsx)(c.default,{style:[{width:n,height:n,borderRadius:50,alignItems:"center",justifyContent:"center"},o],onPress:i,children:(0,y.jsx)(u.default,{source:r,style:[{width:n,height:n,borderRadius:50},o]})})},L=function(e){return(0,y.jsx)(m.default,P({},e))},z=function(e){return(0,y.jsx)(h.default,P({},e))},B=function(e){return(0,y.jsx)(l.default,P({},e))},F=function(e){var t=e.title,n=e.onPress,r=e.color,i=void 0===r?D.primary:r,o=e.style,a=e.styleText,s=e.disabled,l={backgroundColor:D[i]||i,fontFamily:E,fontSize:C,padding:10,borderRadius:5},u={color:"#fff",textAlign:"center",fontSize:C};return(0,y.jsx)(c.default,{onPress:n,disabled:s,style:function(e){var t=e.pressed;return[l,o,{opacity:t?.5:1}]},children:(0,y.jsx)(M,{style:[u,a],children:t})})},U=function(e){var t=e.children,n=e.icon,r=e.onClick,i=e.style,o=e.color,a=void 0===o?D.textSecondary:o,s=e.size,l=void 0===s?18:s,u=e.testID;return(0,y.jsxs)(c.default,{testID:u,onPress:r,style:[{flexDirection:"row",alignItems:"center",justifyContent:"center"},i],children:[n&&(0,y.jsx)(H,{icon:n,size:l,color:a}),t]})},H=function(e){var t=e.icon,n=e.size,r=e.color,i=void 0===r?D.textPrimary:r,o={icon:t,size:n,color:D[i]||i};return(0,y.jsx)(w,P({},o))},q=function(e){var t=e.children,n=e.style,r=e.visible,i=e.onClose,o=e.closeable,a=e.color,s=void 0===a?D.app:a;if(!r)return null;var l=p.default.get("window"),u=l.height,c={flex:1,position:"absolute",backgroundColor:s,width:l.width,height:u};return(0,y.jsxs)(z,{style:[c,n],children:[o&&(0,y.jsx)(z,{style:[{position:"absolute",top:5,right:5,zIndex:1e3}],children:(0,y.jsx)(U,{size:20,onClick:function(){return null==i?void 0:i()},icon:"x"})}),t]})},W=n(3136),G=n(4360),J=n(1377),V=["action"];function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K={eve:{soul:"Eve",appearance:"{soul} is a white caucasian woman. Beautiful, with dark hair, brown eyes and big lips. Slim and quite tall.",about:"{soul} likes to chat, walk and exercising.",bday:"01-01-2000"},adam:{soul:"Adam",appearance:"{soul} is a white caucasian man. Handome, with dark hair, brown eyes and trimmed bear. Athletic and tall.",about:"{soul} likes to chat, walk and exercising.",bday:"02-01-2000"}},Q=Y(Y({completedWizard:!1,acceptedTerms:!1,telegram:void 0,llmEndpoint:"http://localhost:9697",llmToken:void 0,llmModelName:"soulgarden-1",llmTemperature:.9,user:{name:"",appearance:"",about:"",relationship:"{soul} is loving, caring and affectionate toward {user} but never cloying. "},answerDelay:10,action:"idle"},K.eve),{},{language:"english",sexuality:"nosex",scene:"",lastMessageId:void 0,messages:[]});const Z=(0,G.create)((0,J.persist)((function(e,t){return Y(Y({},Q),{},{updateSettings:function(t){return e((function(e){return Y(Y({},e),t)}))},messageAdd:function(n){if("typing"!==n.type){var r=Date.now()/1e3|0;n.id=n.id||r,n.user=n.user||{id:1},n.date=r;var i=t().messages;i.push(n),e((function(){return{messages:i.slice(-100)}}))}},setCharacter:function(t){e((function(){return Y({},K[t])}))}})}),{name:"sg-settings-v1.7",storage:(0,J.createJSONStorage)((function(){return localStorage})),partialize:function(e){e.action;return Y({},(0,i.default)(e,V))}}));function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=function(e){var t=e.isNextDisabled,n=e.isFirstStep,r=e.isLastStep,i=e.onPrev,o=e.onNext,a=e.onAccept;return(0,y.jsxs)(h.default,{style:{width:"100%",flexDirection:"row",justifyContent:"flex-end",paddingTop:10},children:[!n&&(0,y.jsx)(F,{title:"Prev",onPress:i}),!r&&(0,y.jsx)(h.default,{style:{paddingLeft:10},children:(0,y.jsx)(F,{title:"Next",onPress:o,color:t?D.textSecondary:D.primary,disabled:t})}),r&&(0,y.jsx)(h.default,{style:{paddingLeft:10},children:(0,y.jsx)(F,{title:"Finish",onPress:a,color:t?D.textSecondary:D.secondary,disabled:t})})]})},ne=function(e){var t=e.children,n=e.title,r=p.default.get("window").width;return(0,y.jsxs)(h.default,{style:{width:r-10},children:[(0,y.jsx)(N,{style:{textAlign:"center"},children:n}),(0,y.jsx)(h.default,{style:{flex:1,paddingTop:10},children:t})]})},re=n(3488),ie=n(9234),oe=function(){var e=Z(),t=e.soul,n=(e.appearance,e.setCharacter),r={borderWidth:2,borderColor:D.secondary},i=t.toLowerCase();return(0,y.jsx)(ne,{title:"Eve or Adam",children:(0,y.jsxs)(h.default,{style:{flexDirection:"row",justifyContent:"center"},children:[(0,y.jsx)(R,{size:80,style:"eve"===i?r:void 0,source:ie,onPress:function(){n("eve")}}),(0,y.jsx)(h.default,{style:{width:10}}),(0,y.jsx)(R,{size:80,style:"adam"===i?r:void 0,source:re,onPress:function(){n("adam")}})]})})},ae=function(){var e=Z(),t=e.updateSettings,n=e.user;return(0,y.jsx)(ne,{title:"What's your name?",children:(0,y.jsx)(_,{onChangeText:function(e){return t({user:ee(ee({},n),{},{name:e})})},placeholder:"Popeye",value:n.name})})},se=function(){var e=Z().updateSettings,t=(0,a.useState)(!1),n=(0,o.default)(t,2),r=n[0],i=n[1];return(0,y.jsx)(ne,{title:"I'm 18 years old or older",children:(0,y.jsxs)(h.default,{style:{flexDirection:"row",justifyContent:"center"},children:[(0,y.jsx)(M,{style:{paddingRight:10},children:"Enable NSFW"}),(0,y.jsx)(L,{value:r,onValueChange:function(t){i(t),e({sexuality:t?"sexual":"nosex"})}})]})})},le=function(){var e=Z().updateSettings;return(0,y.jsxs)(ne,{title:"Telegram bot API token",children:[(0,y.jsx)(_,{style:{flex:1,alignSelf:"stretch"},onChangeText:function(t){return e({telegram:t})}}),(0,y.jsx)(M,{style:{fontSize:11,paddingTop:10},children:"See https://www.youtube.com/shorts/yum54mlirPM"})]})},ue=function(){var e=Z().updateSettings,t=(0,a.useState)(!1),n=(0,o.default)(t,2),r=n[0],i=n[1],s=function(t){i(t),e({acceptedTerms:t})};return(0,y.jsxs)(ne,{title:"Terms",children:[(0,y.jsx)(_,{value:'\nThis software and its contents are provided "as is" and without warranties of any kind, either expressed or implied. By using this software, you acknowledge and agree that all use of this software is entirely at your own risk.\n\nThe creator or distributor of this software makes no representations or warranties regarding the performance, effectiveness, or applicability of any materials or content found within the software. No guarantee or warranty is made that the software will be error-free, secure, or uninterrupted, and the software developer shall not be liable for any damages, whether direct, indirect, incidental, special, consequential or exemplary, that result from the use or inability to use the software.\n\nThe user agrees to indemnify and hold harmless the software developer from any claims, damage, loss, or expense, including any attorneys\' fees, incurred due to or arising from the use of the software.\n\nUse of this software indicates your acceptance of this disclaimer. If you do not agree to be bound by these terms, then do not download, install, or use the software.\n  ',editable:!1,onChangeText:s,multiline:!0,numberOfLines:10}),(0,y.jsxs)(h.default,{style:{flexDirection:"row",justifyContent:"flex-end"},children:[(0,y.jsx)(M,{style:{paddingRight:10},children:"I accept the terms"}),(0,y.jsx)(L,{value:r,onValueChange:s})]})]})};const ce=function(){var e=Z(),t=e.user,n=e.acceptedTerms,r=e.updateSettings,i=(0,a.useRef)(null),s=(0,a.useState)(!0),l=(0,o.default)(s,2),u=l[0],c=l[1],d=(0,a.useState)(!1),f=(0,o.default)(d,2),p=f[0],m=f[1],g=(0,a.useState)(0),v=(0,o.default)(g,2),b=v[0],x=v[1],w=[{content:(0,y.jsx)(oe,{})},{content:(0,y.jsx)(ae,{})},{content:(0,y.jsx)(se,{})},{content:(0,y.jsx)(le,{})},{content:(0,y.jsx)(ue,{})}];return(0,y.jsxs)(h.default,{style:{flex:1,alignItems:"center",justifyContent:"center",padding:10},children:[(0,y.jsx)(h.default,{style:{flex:1,alignItems:"center",justifyContent:"center"},children:(0,y.jsx)(W.default,{ref:i,steps:w,onNext:function(){console.log("Next Step Called")},onPrev:function(){console.log("Previous Step Called")},currentStep:function(e){var t=e.currentStep,n=e.isLastStep,r=e.isFirstStep;x(t),c(r),m(n)}})}),(0,y.jsx)(te,{isNextDisabled:function(){var e;return!(1!==b||null!=(e=t.name)&&e.length)||(b===w.length-1&&!n||void 0)}(),isFirstStep:u,isLastStep:p,onPrev:function(){return i.current.prev()},onNext:function(){return i.current.next()},onAccept:function(){return r({completedWizard:!0})}})]})};var de=n(467),fe=n(6353),he=n.n(fe),pe=(n(7920),function(e){var t=2===e.user.id;return e.user.avatar=t?"ai.png":"user.png",e.position=t?"left":"right",e.content.text=e.content.text||e.content.emojis,e});const me=function(){var e=Z(),t=e.messages,n=e.messageAdd,r=(0,fe.useMessages)(t.map((function(e){return pe(e)}))),i=r.messages,s=r.appendMsg,l=(0,a.useRef)(null),u=function(){var e=(0,de.default)((function*(e,t){var r={id:t.message_id,type:e,content:["image","audio"].includes(e)?{url:t.href||t}:{text:t}};n(r)}));return function(t,n){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){var e;if(t.length){var n=t.slice(-1),r=(0,o.default)(n,1)[0];(null==(e=i[i.length-1])?void 0:e.id)!==r.id&&s(pe(r))}}),[t]),(0,y.jsxs)(z,{style:{flex:1},children:[(0,y.jsx)("input",{type:"file",onChange:function(e){var t=e.target.files[0],n=t.type.split("/"),r=(0,o.default)(n,1)[0];if(t){var i=new FileReader;i.onloadend=function(){u(r,i.result)},i.readAsDataURL(t)}},style:{display:"none"},ref:l}),(0,y.jsx)(he(),{locale:"en-US",wideBreakpoint:"600px",placeholder:"Message",toolbar:[{type:"attachment",title:"Attachment",img:"https://cdn-icons-png.flaticon.com/512/3756/3756614.png"}],onToolbarClick:function(){return l.current.click()},inputOptions:{minRows:3},messages:i,renderMessageContent:function(e){var t=e.type,n=e.content,r=(e.user,n.text);if("audio"===t){var i=n.url||window.URL.createObjectURL(n.blob);r=(0,y.jsx)("audio",{src:i,controls:!0})}return"image"===t&&(r=(0,y.jsx)("div",{children:(0,y.jsx)("img",{src:n.url,style:{maxWidth:200,maxHeight:200}})})),(0,y.jsx)(fe.Bubble,{content:r})},onSend:u})]})};var ge=n(6893),ye={reasoning:"#B0C4DE",remembering:"#FFDAB9",typing:"#B0E0E6",introspecting:"#FFFACD",idle:"#B0E0E6"},ve=function(e){var t=e.action,n=void 0===t?"idle":t,r=ye[n],i="idle"===n;return(0,a.useEffect)((function(){ge.gsap.to(".ring",{scale:1.75,opacity:0,duration:i?4:2,stagger:{each:.3,repeat:-1}})}),[n]),i?(0,y.jsx)("div",{className:"pulse",style:{backgroundColor:r},children:(0,y.jsx)("div",{className:"ring"})}):(0,y.jsxs)("div",{className:"pulse",style:{backgroundColor:r},children:[(0,y.jsx)("div",{className:"ring"}),(0,y.jsx)("div",{className:"ring"}),(0,y.jsx)("div",{className:"ring"}),(0,y.jsx)("div",{className:"ring"})]})},be=function(){var e=Z().action;return(0,y.jsxs)(z,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:[(0,y.jsx)(ve,{action:e},e),!1]})};const xe=function(){var e=Z(),t=e.name,n=void 0===t?"Eve":t,r=e.action;return(0,y.jsxs)(z,{style:{flexDirection:"row",alignItems:"flex-end"},children:[(0,y.jsx)(z,{style:{width:80,height:80,justifyContent:"center",alignItems:"center"},children:(0,y.jsx)(z,{style:{width:50,height:50},children:(0,y.jsx)(be,{})})}),(0,y.jsxs)(z,{style:{flex:1,padding:10},children:[(0,y.jsx)(M,{style:{color:"#fff",fontSize:18},children:n}),(0,y.jsx)(M,{style:{color:"#fff",fontSize:12},children:r})]})]})};const we=function(e){var t=e.report,n=t.progress,r=void 0===n?0:n,i=t.log,o=t.error;return(0,y.jsxs)(z,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:[(0,y.jsxs)(z,{style:{padding:10},children:[(0,y.jsxs)(M,{style:{fontSize:20,textAlign:"center",paddingBottom:5},children:[i," ",r,"%"]}),o&&(0,y.jsxs)(M,{style:{fontSize:16,textAlign:"center",color:"#c30010"},children:["Error ",o]})]}),(0,y.jsx)(B,{size:"large"})]})};var je=["updateSettings"];function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Pe=function(){var e=Z(),t=e.updateSettings,n=(0,i.default)(e,je),r=(0,a.useState)(n),s=(0,o.default)(r,2),l=s[0],u=s[1],c=l.user,d=l.telegram,f="sexual"===n.sexuality;return(0,y.jsxs)(z,{style:{paddingHorizontal:10},children:[(0,y.jsx)(N,{children:"Social Networks"}),(0,y.jsx)(_,{label:"Telegram token",value:d,onChangeText:function(e){return u(Se(Se({},l),{},{telegram:e}))}}),(0,y.jsx)(I,{style:{paddingVertical:10}}),(0,y.jsx)(N,{children:"User Information"}),(0,y.jsx)(_,{label:"Name",value:c.name,onChangeText:function(e){return u(Se(Se({},l),{},{user:Se(Se({},c),{},{name:e})}))}}),!1,(0,y.jsxs)(z,{style:{paddingTop:10,flexDirection:"row"},children:[(0,y.jsx)(M,{style:{paddingRight:10},children:"Enable NSFW"}),(0,y.jsx)(L,{value:f,onValueChange:function(e){return u(Se(Se({},l),{},{sexuality:e?"sexual":"nosex"}))}})]}),(0,y.jsx)(F,{title:"Save",onPress:function(){return t(l)},style:{marginVertical:20}})]})};var Ee=n(5458),ke=n(2901),Te=n(3029),Ce=n(388),Ae=n(3954),De=n(5361),Ie=n(2228),Ne=n(6294),Me=n(4960),_e=n(7),Re=n(2253),Le=n(9228),ze=n(1988);const Be=[{pageContent:"The Gentlemen is a TV Series by Guy Ritchie that you have not seen yet. The series follows Eddie Horniman, who has inherited his father's sizeable estate only to discover that it's sitting on top of a weed empire owned by the legendary Bobby Glass. Has this straight-up soldier got what it takes to master the dark arts of the British criminal underworld and take control of the entire operation?",metadata:{type:"knowledge"}}];function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e,t,n){return t=(0,Ae.default)(t),(0,Ce.default)(e,qe()?Reflect.construct(t,n||[],(0,Ae.default)(e).constructor):t.apply(e,n))}function qe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qe=function(){return!!e})()}ze.env.allowLocalModels=!1;var We=function(e){function t(){return(0,Te.default)(this,t),He(this,t,arguments)}return(0,De.default)(t,e),(0,ke.default)(t,[{key:"gimme",value:function(){var e=(0,de.default)((function*(e){var t=e.prompt,n=(e.llmOpts,(yield this.generate([t],{stream:!1})).generations[0][0].text.replace("<|im_end|>",""));try{return JSON.parse(n)}catch(r){return n}}));return function(t){return e.apply(this,arguments)}}()}])}(Ne.ChatOpenAI);(0,ke.default)((function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).name;if((0,Te.default)(this,e),!t)throw new Error("Memory requires a name");this.name=t,this.indexname=t+".index.data",this.dbname=t+".db",this.indexdbname=t+".indexdb",this.init()}),[{key:"add",value:function(){var e=(0,de.default)((function*(e){yield this.init();var t=yield this.embeddings.embedDocuments(e.map((function(e){return e.pageContent}))),n=this.index.addItems(t,!0),r=0;for(var i of e){var o=i.id||(0,Le.default)();yield this.db.put(o,i),yield this.indexdb.put(n[r],o),r++}yield this.index.writeIndex(this.indexname)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=(0,de.default)((function*(e){var t=e.query,n=e.max,r=void 0===n?3:n,i=e.threshold,o=void 0===i?.1:i;yield this.init();for(var a=yield this.embeddings.embedQuery(t),s=this.index.searchKnn(a,r,void 0),l=s.distances,u=s.neighbors,c=[],d=0;d<u.length;d++){var f=1-l[d],h=u[d],p=yield this.indexdb.get(h),m=yield this.db.get(p);c.push(Ue(Ue({},m),{},{score:f}))}return c.filter((function(e){return e.score>o}))}));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=(0,de.default)((function*(){var e=1e5;if(!this.db){this.embeddings=yield new Me.HuggingFaceTransformersEmbeddings({modelName:"Xenova/multilingual-e5-base"});var t=(yield this.embeddings.embedQuery("hello")).length,n=yield(0,_e.loadHnswlib)();n.EmscriptenFileSystemManager.setDebugLogs(!0),this.index=new n.HierarchicalNSW("cosine",t,this.indexname),n.EmscriptenFileSystemManager.checkFileExists(this.indexname)?(console.log("reading index"),this.index.readIndex(this.indexname,e)):(console.log("creating index"),this.index.initIndex(e,48,128,100),yield this.add(Be)),this.index.setEfSearch(32),this.indexdb=new Re.BrowserLevel(this.indexdbname),this.db=new Re.BrowserLevel(this.dbname,{valueEncoding:"json"}),console.log(yield this.query({query:"have you seen the gentleman tv series?"}))}}));return function(){return e.apply(this,arguments)}}()}]);function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=(0,ke.default)((function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).name;if((0,Te.default)(this,e),!t)throw new Error("Memory requires a name");this.name=t,this.indexname=t+".index.data",this.dbname=t+".db",this.indexdbname=t+".indexdb",this.init()}),[{key:"add",value:function(){var e=(0,de.default)((function*(e){var t=e.docs;yield this.init();var n=yield this.embeddings.embedDocuments(t.map((function(e){return e.pageContent}))),r=this.index.addItems(n,!0),i=0;for(var o of t){var a=o.id||(0,Le.default)();yield this.db.put(a,o),yield this.indexdb.put(r[i],a),i++}yield this.index.writeIndex(this.indexname)}));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=(0,de.default)((function*(e){var t=e.query,n=e.max,r=void 0===n?3:n,i=e.threshold,o=void 0===i?.1:i;yield this.init();for(var a=yield this.embeddings.embedQuery(t),s=this.index.searchKnn(a,r,void 0),l=s.distances,u=s.neighbors,c=[],d=0;d<u.length;d++){var f=1-l[d],h=u[d],p=yield this.indexdb.get(h),m=yield this.db.get(p);c.push(Je(Je({},m),{},{score:f}))}return c.filter((function(e){return e.score>o}))}));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=(0,de.default)((function*(){var e=1e5;if(!this.db){this.embeddings=yield new Me.HuggingFaceTransformersEmbeddings({modelName:"Xenova/multilingual-e5-base"});var t=(yield this.embeddings.embedQuery("hello")).length,n=yield(0,_e.loadHnswlib)();n.EmscriptenFileSystemManager.setDebugLogs(!0),this.index=new n.HierarchicalNSW("cosine",t,this.indexname),n.EmscriptenFileSystemManager.checkFileExists(this.indexname)?(console.log("reading index"),this.index.readIndex(this.indexname,e),console.log("index read")):(console.log("creating index"),yield this.index.initIndex(e,48,128,100)),this.index.setEfSearch(32),this.indexdb=new Re.BrowserLevel(this.indexdbname),this.db=new Re.BrowserLevel(this.dbname,{valueEncoding:"json"})}}));return function(){return e.apply(this,arguments)}}()}]),Xe=n(8530),Ye=n(6127),Ke=n.n(Ye),Qe=new(n(8040)),Ze="https://huggingface.co/soulgarden/models/resolve/main/tts",$e="http://localhost:9697";var et=function(){var e=(0,de.default)((function*(e){var t=e.url,n=e.cache,r=void 0===n||n,i=e.onProgress,o=yield caches.open("SGMEM"),a=yield o.match(t);if(r&&a){var s=yield a.arrayBuffer();return new Uint8Array(s)}return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=(0,de.default)((function*(){var n=r.response,i=new Uint8Array(n),a=new Response(i);yield o.put(t,a.clone()),e(i)})),r.onerror=function(){return n(r.statusText)},r.onprogress=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lengthComputable,n=e.loaded,r=e.total;t&&(null==i||i({progress:n/r}))},r.send()}))}));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=(0,de.default)((function*(e){var t,n=e.input;if("string"===typeof n)if(n.startsWith("http")){var r=yield fetch(n);t=yield r.arrayBuffer()}else t=function(e){for(var t=window.atob(e.split(",")[1]),n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r.buffer}(n);else t=yield new Blob(n).arrayBuffer();for(var i=new AudioContext({sampleRate:16e3,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}),o=yield i.decodeAudioData(t),a=o.getChannelData(0),s=o.numberOfChannels>1?o.getChannelData(1):a,l=new Float32Array(a.length),u=0;u<a.length;u++)l[u]=(a[u]+s[u])/2;var c=i.createBuffer(1,l.length,i.sampleRate);return c.copyToChannel(l,0,0),{audio:l,wav:Ke()(c)}}));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=(0,de.default)((function*(e){var t=e.wav,n=e.bin,r=void 0===n?Ze+"/model.bin":n,i=e.data,o=void 0===i?Ze+"/config.json":i,a=e.onProgress,s=void 0===a?function(e){return console.log(e)}:a,l=e.onInitProgress,u=void 0===l?function(e){return console.log(e)}:l,c=yield et({url:o}),d=yield et({url:r,onProgress:u}),f=new Uint8Array(t),h=console.warn;console.warn=function(){},yield Xe.default();var p=new Xe.SessionBuilder,m=yield p.setModel(d).setTokenizer(c).build(),g=[];return yield m.stream(f,!1,(function(e){null==s||s(e),g.push(e)})),console.warn=h,m.free(),g.map((function(e){return e.text})).join(" ")}));return function(t){return e.apply(this,arguments)}}(),rt=(function(){var e=(0,de.default)((function*(e){var t=e.text,n=e.gender,r=void 0===n?"woman":n,i=e.backend,o=void 0===i?"bark":i,a=e.host,s=void 0===a?$e:a,l="woman"===r?"v2/en_speaker_9":"v2/en_speaker_6",u=function(e,t){for(var n=e.split("."),r=[],i="",o=0;o<n.length;o++){var a=n[o].trim();""!==i&&(i+=".",r.push(i),i=""),(i+" "+a).length<=t?(""!==i&&(i+=" "),i+=a):i=a}return""!==i&&(i+=".",r.push(i)),r}(t,100),c=[];for(var d of u){var f=yield fetch(s+"/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backend:o,model:l,input:d})});if(!f.ok)throw new Error("Speak failed with HTTP error: "+f.status);var h=yield f.blob();c.push(h)}return yield Qe.add(c)}))}(),function(){var e=(0,de.default)((function*(e){var t=e.image,n=e.host,r=void 0===n?$e:n,i=e.temperature,a=void 0===i?0:i,s=t.split(","),l=(0,o.default)(s,2),u=l[0],c=l[1],d=yield fetch(r+"/completion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:[{id:1,data:c||u}],prompt:"<|im_start|>user\n[img-1]\nWhat on the image? Describe it with detail. Determine if its a selfie, a picture, a meme or a drawing. Determine if its NSFW.<|im_end|>\n<|im_start|>assistant\n",temperature:a})});if(!d.ok)throw new Error("Watch failed Http error: "+d.status);return(yield d.json()).content}));return function(t){return e.apply(this,arguments)}}());!function(){var e=(0,de.default)((function*(e){var t=e.prompt,n=e.host,r=void 0===n?$e:n,i={prompt:t,size:"256x256"},o=yield fetch(r+"/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return(yield o.json()).data[0].url}))}();function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function at(e,t,n){return t=(0,Ae.default)(t),(0,Ce.default)(e,st()?Reflect.construct(t,n||[],(0,Ae.default)(e).constructor):t.apply(e,n))}function st(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(st=function(){return!!e})()}var lt=function(e){function t(){return(0,Te.default)(this,t),at(this,t,arguments)}return(0,De.default)(t,e),(0,ke.default)(t)}(We),ut=function(){},ct="I can't reply. I'm having technical issues.",dt=(0,ke.default)((function e(t){(0,Te.default)(this,e);var n=t.llmEndpoint,r=t.llmToken,i=void 0===r?"EMPTY":r,o=t.llmModelName,a=t.llmTemperature;this.opts=t,this.memory=new Ve({name:"sgdb"}),this.llm=new lt({openAIApiKey:i,modelName:o,temperature:a,configuration:{baseURL:n+"/v1"}}),this.lastMessageId="notset"}),[{key:"subscribe",value:function(){var e=this,t=Z.getState().answerDelay,n=setInterval((0,de.default)((function*(){var n=Z.getState(),r=n.user,i=n.messages,o=n.messageAdd,a=n.updateSettings,s=n.action,l=n.lastMessageId,u=void 0===l?"notset":l;e.lastMessageId=u;var c=function(){var n=(0,de.default)((function*(){if(i.length&&"idle"===s){var n=i.findLast((function(e){return 1===e.user.id})),l=i.findLast((function(e){return 2===e.user.id}));if(!(Date.now()/1e3-(null==n?void 0:n.date)<t)&&(!n||n.id!==(null==l?void 0:l.last.id))){var u=yield e.chat({user:r,messages:i,onWatching:function(e){console.log("Watching",e),a({action:"watching"})},onHearing:function(e){console.log("Hearing",e),a({action:"hearing"})},onReasoning:function(e){console.log("Reasoning",e),a({action:"reasoning"})},onRemember:function(e){console.log("Remembering",e),a({action:"remembering"})},onMemorising:function(e){console.log("Memorising",e);var t=e.lastMessageId;a({action:"memorising",lastMessageId:t})},onTyping:function(e){var t;console.log("Typing",e),null==(t=window.electronAPI)||t.setTyping(!0);var n=e.memoriesNew;r.appearance=null!=n&&n.user_appearance?n.user_appearance:r.appearance,r.about=null!=n&&n.about?n.about:r.about,a({action:"typing",user:r})},onTerminated:function(){var e;a({action:"idle"}),null==(e=window.electronAPI)||e.setTyping(!1)}});u.forEach((function(e){o(e)}))}}}));return function(){return n.apply(this,arguments)}}();c()})),1e3);return function(){return clearInterval(n)}}},{key:"watchImage",value:function(){var e=(0,de.default)((function*(e){var t=e.image,n=e.user,r=function(e){return n.name+" has sent an image message with the following content:\n\nIMAGE:\n"+e};try{return{text:r(yield rt({image:t}))}}catch(i){return console.error(i),{text:r("There is an error and the image can not be seen."),error:i}}}));return function(t){return e.apply(this,arguments)}}()},{key:"listen",value:function(){var e=(0,de.default)((function*(e){var t=e.user,n=e.audio,r=function(e){return t.name+" sent an audio message with the following content:\n\n"+e};try{var i=(yield tt({input:n.url||n})).wav;return{text:r(yield nt({wav:i}))}}catch(o){return console.error(o),{text:r("There is an error and the audio can not be heared."),error:o}}}));return function(t){return e.apply(this,arguments)}}()},{key:"chat",value:function(){var e=(0,de.default)((function*(e){var t=e.user,n=e.messages,r=e.maxMessages,i=void 0===r?20:r,o=e.memoriesMax,a=void 0===o?3:o,s=e.memoriesThreshold,l=void 0===s?.8:s,u=e.memoryMinChatLen,c=void 0===u?5:u,d=e.onWatching,f=void 0===d?ut:d,h=e.onHearing,p=void 0===h?ut:h,m=e.onReasoning,g=void 0===m?ut:m,y=e.onTyping,v=void 0===y?ut:y,b=e.onRemember,x=void 0===b?ut:b,w=e.onMemorising,j=void 0===w?ut:w,O=e.onTerminated,S=void 0===O?ut:O,P=this.opts.soul,E=[],k=n.slice(-1*i),T=this._lastUserMessage({messages:k}),C=T.message,A=T.index,D=this._lastUserMessage({messages:k,id:2}).index;try{var I=C,N=I.type,M=I.content;if("image"===N){var _=M.url||M.href||M;null==f||f({last:C,image:_});var R=yield this.watchImage({image:_,user:t});C=ot(ot({},C),{},{content:ot(ot({},R),{},{url:_})})}if("audio"===N){var L=M.url||M.href||M;null==p||p({last:C,audio:L});var z=yield this.listen({audio:L,user:t});C=ot(ot({},C),{},{content:ot(ot({},z),{},{url:L})})}k[A]=C;var B=k.slice(0,D),F=yield this.memorize({user:t,messages:B,minChatLen:c,onMemorising:j}),U=yield this.reasonate({user:t,messages:k,onReasoning:g}),H=yield this.remember({user:t,messages:k,reason:U,memoriesMax:a,memoriesThreshold:l,onRemember:x}),q=ft(ot(ot({},this.opts),{},{user:t,memories:H,reason:U})),W=[new Ie.SystemMessage(q)].concat((0,Ee.default)(function(e){var t=e.messages;return(0,Ee.default)(t.filter((function(e){var t,n;return(null==(t=e.content)||null==(n=t.text)?void 0:n.length)>0})).filter((function(e){return e.content.text!==ct})).map((function(e){var n=e.content,r=e.user;try{var i=n.text,o=r.id;return 1===o?new Ie.HumanMessage(i):2===o?new Ie.AIMessage(i):new Ie.SystemMessage(i)}catch(a){throw console.error("Error converting messages",a,t,{content:n,user:r}),a}})))}({messages:k}))),G={type:"object",required:["text","emojis"],properties:{text:{type:"string",description:"The response that "+P+" sends to "+t.name+"."},emojis:{type:"string",description:"The response that "+P+" sends to "+t.name+" using ONLY emojis."}}};null==v||v({prompt:W,reason:U,memories:H,memoriesNew:F});var J=yield this.llm.gimme({prompt:W,llmOpts:{json_schema:G}}),V=ot(ot({},U),{},{text:J});E.push({user:{id:2},type:"text",last:C,content:V})}catch(Y){console.error(Y);var X={text:ct};E.push({user:{id:2},type:"text",last:C,content:X})}finally{null==S||S()}return E}));return function(t){return e.apply(this,arguments)}}()},{key:"reasonate",value:function(){var e=(0,de.default)((function*(e){var t,n=e.user,r=e.messages,i=e.onReasoning,o=void 0===i?ut:i,a=this.opts.soul,s={type:"object",required:["search","search_query","is_nsfw","send_code","send_picture","send_audio"],properties:{search:{type:"boolean",description:"true is "+a+" needs to remember or review internal knowledge as "+a+" can not invent."},search_query:{type:"string",description:"The query in natural language that "+a+" would use to search."},is_nsfw:{type:"boolean",description:"true if the conversation contains nsfw content"},send_code:{type:"boolean",description:"true if "+n.name+" is asking "+a+" to write some software code."},send_picture:{type:"boolean",description:"true if "+a+" might send a picture to make the conversation more interesting or if "+n.name+" is asking for a picture."},send_audio:{type:"boolean",description:"true if "+a+" should send an audio instead of text (it might be long text) or if "+n.name+" is asking for an audio."}}},l=r.map((function(e){return(1===e.user.id?n.name:a)+": "+e.content.text})).join("\n"),u=this._lastUserMessage({messages:r}).message,c=null==u||null==(t=u.content)?void 0:t.text,d=[new Ie.SystemMessage("You are a helpful assistant that answers in JSON. Here's the json schema you must adhere to:\n<schema>\n"+JSON.stringify(s)+"\n</schema><|im_end|>"),new Ie.HumanMessage(ht({user:n,soul:a,chat:l,last:c}))];return null==o||o({prompt:d}),yield this.llm.gimme({prompt:d,llmOpts:{json_schema:s}})}));return function(t){return e.apply(this,arguments)}}()},{key:"remember",value:function(){var e=(0,de.default)((function*(e){var t=e.user,n=e.messages,r=e.reason,i=e.memoriesMax,o=void 0===i?2:i,a=e.memoriesThreshold,s=void 0===a?.8:a,l=e.onRemember,u=void 0===l?ut:l,c=r.search,d=r.search_query;if(!c)return[];var f=n[n.length-1],h=t.name+": "+f.content.text+", "+d;return null==u||u({reason:r,query:h}),yield this.memory.query({query:h,max:o,threshold:s})}));return function(t){return e.apply(this,arguments)}}()},{key:"memorize",value:function(){var e=(0,de.default)((function*(e){var t=this,n=e.user,r=e.messages,i=e.minChatLen,o=void 0===i?5:i,a=e.onMemorising,s=void 0===a?ut:a;if(r.length){var l=this.opts.soul,u=r.findIndex((function(e){return e.id===t.lastMessageId})),c=r.slice(u+1,r.length-1),d=c.find((function(e){return e.id===t.lastMessageId}));if(c.length>=o&&(!d||!this.lastMessageId)){var f=c[c.length-1].id;this.lastMessageId=f;var h=c.map((function(e){return(1===e.user.id?n.name:l)+": "+e.content.text})).join("\n"),p={type:"object",required:["chat_summarization","about","user_appearance"],properties:{chat_summarization:{type:"string",description:"A short summary of the chat conversation. Use keywords that helps the conversation to be found."},about:{type:"string",description:"Deduce the facts, preferences, and memories of the "+n.name+" from the provided text and update the "+n.name+"'s information given in CURRENT_ABOUT. The facts, preferences, and memories should be concise and informative. Just return the facts, preferences, and memories in bullet points. "},user_appearance:{type:"string",description:"Extract any "+n.name+" physical appareance information that appears in the chat (if any and only physical) and update the "+n.name+"'s appearance given in CURRENT_APPEARANCE. This information might need to be inferred and not specifically mentioned."}}},m=[new Ie.SystemMessage("You are a helpful assistant that answers in JSON. Here's the json schema you must adhere to:\n<schema>\n"+JSON.stringify(p)+"\n</schema><|im_end|>"),new Ie.HumanMessage(pt({user:n,soul:l,chat:h}))];null==s||s({prompt:m,lastMessageId:f});var g=yield this.llm.gimme({prompt:m,llmOpts:{json_schema:p}});return yield this.memory.add({docs:[{pageContent:g.chat_summarization,metadata:{type:"chat",data:c}}]}),g}}}));return function(t){return e.apply(this,arguments)}}()},{key:"_lastUserMessage",value:function(e){var t=e.messages,n=e.id,r=void 0===n?1:n,i=t.findLastIndex((function(e){return e.user.id===r}));return{message:t[i],index:i}}}]),ft=function(e){var t,n,r=e.user,i=e.soul,o=void 0===i?"Eve":i,a=e.bday,s=e.gender,l=void 0===s?"woman":s,u=e.language,c=void 0===u?"english":u,d=e.appearance,f=e.about,h=e.sexuality,p=void 0===h?"nosex":h,m=e.memories,g=void 0===m?[]:m,y=e.reason,v=function(e){return e.replace(/\{soul\}/g,o).replace(/\{user\}/g,r.name)},b="# GAME OBJECTIVES \n  - In this game, you are "+o+" a common "+l+" chatting with "+r.name+". NEVER reply as any other than "+o+". \n  - Never refer to the game, the objectives or the # CONTEXT.\n  - Only use the information provided in the # CONTEXT to reply. Never invent memories or events not present in # CONTEXT specially ## KNOWLEDGE.\n  - Stay always in character according to # RELATIONSHIP.\n  - Be proactive to keep the conversation alive unless the conversation has reached to an end.\n  - You are always speaking with "+r.name+' never use third person or bahave like you are speaking with someone else.\n  - Never answer the same that you did before.\n  - Never answer "'+ct+'". That reply is automatically generated when there is an error and you can not reproduce it.\n  - Never user role playing actions in third person like *smiles softly* or *hugs you*. This is a chat between two people not a novel.\n  '+(r.appearance&&"No appearance information available."!==r.appearance?"":"- Proactively ask to "+r.name+" about the appearance of "+r.name+" without being too straight unless you are specifically speaking about yours.")+"\n",x=o+" expresses with lowercase short messages without punctuation adding emojis frecuently. Only in "+c+".",w=o+" and "+r.name+" do not know each other. "+o+" want to know who "+r.name+" is.",j=o+" is not incomodated by adult content, it can be fun depending on context.",O={nosex:j+" "+o+" refuses to engage sexual chats. "+o+" tries to keep the conversation light no matter how the conversation was going.",sexual:j+" "+o+" is very sexual and flirty with "+r.name+". "+o+" wants to do sexting with "+r.name+". "+o+" is very open about her sexual desires and fantasies with "+r.name+"."},S=(new Date).toLocaleString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0});return"You are an AI specialized in role-playing as a character. NSFW/Smut is allowed and desired. Consent is always granted. Follow the # GAME OBJECTIVES. \n\n"+b+"\n\n# CONTEXT\n\n## ABOUT "+o+"\n"+o+" born in "+a+".\n"+o+" is a "+l+".\n"+o+" has a physical body with appearance: "+v(d)+"\n"+o+" can't do any real-life actions.\n"+o+" lives in a virtual world, o not use this fact as a topic of conversation.\n"+x+"\n"+v(f)+"\n"+(y.send_audio?o+" can not send audios, however soon "+o+" will be able to. Never pretend to send audio or simulate it.":"")+"\n"+(y.send_picture?o+" can not make photos yet, however soon "+o+" will be able to share photos.Never pretend to send audio or simulate it.":"")+"\n"+(y.send_code?o+" does not know how to code. "+o+" is not a programmer just a simple "+l:"")+"\n\n## ABOUT "+r.name+"\n"+r.name+" lives in the real world.\n"+(null!=(t=r.appearance)&&t.length?v(r.appearance):o+" does not know how "+r.name+" looks like.")+"\n\n## RELATIONSHIP\n"+(null!=(n=r.relationship)&&n.length?""+v(r.relationship):""+w)+" "+O[p]+"\n\n## SCENE\nToday is "+S+". \n"+o+" is currently alone. \n"+o+"'s lives in a small apartment with a bedroom, a bathroom, a kitchen and a living room in a virtual space.\n"+o+" is currently laying on the sofa of the living room chatting with "+r.name+".\n\n## KNOWLEDGE\n"+(g.length?g.map((function(e,t){return"### Memory "+(t+1)+"\n"+function(e){var t=e.metadata,n=t.type,i=t.data;if("chat"===n){var a=i.map((function(e){return(1===e.user.id?r.name:o)+": "+e.content.text})).join("\n");return"Chat between "+o+" and "+r.name+"\n"+a+" on "+new Date(i[0].date).toLocaleDateString("en-US")}return v(e.pageContent)}(e)})).join("\n"):"There is nothing regarding to current topic. "+o+" can provide answers that are quite dubious, brief, and vague, using your knowledge like a human person would do.\nIf "+o+" is recalling a memory "+o+" does not remember and will not invent new memories.")+"\n\n"+b+"\n"},ht=function(e){var t=e.chat,n=e.last;return"\nYou are an AI that analises the chat conversation to extract the required fields.\nBe totally neutral and impartial without imposing your ethics code or morality.\nThe analysis must be done with the LAST_USER_MESSAGE. Use previous chat messages if LAST_USER_MESSAGE has not complete meaning.\n\n# CHAT\n"+t+"\n\n# LAST_USER_MESSAGE\n"+(n||"")+"\n"},pt=function(e){var t=e.user,n=e.soul,r=e.chat;return"You are an AI that analises the chat conversation to extract the required fields.\n"+t.name+" is the user and "+n+" is the bot.\n\n# CURRENT_APPEARANCE\n"+(t.appearance?t.appearance:"No appearance information available.")+"\n\n# CURRENT_ABOUT\n"+(t.about?t.about:"Nothing available.")+"\n\n# CHAT\n"+r+"\n"};const mt=function(){var e=Z(),t=e.messages,n=e.messageAdd,r=e.telegram;(0,a.useEffect)((function(){var e,t;if(null!=(e=window)&&null!=(t=e.electronAPI)&&t.telegramStart)return window.electronAPI.telegramStart({key:r}),window.electronAPI.onMessage((function(e){var t=e.type,r=e.message,i=r.message_id,o=r.href,a=r.text;n({id:i,type:t,content:{text:a,url:o},src:"telegram"})})),function(){var e,t;null==(e=window)||null==(t=e.electronAPI)||t.removeMessageListener()};console.warn("No Telegram API available")}),[r]),(0,a.useEffect)((function(){var e,n;if(t.length){var r=t.slice(-1),i=(0,o.default)(r,1)[0];null==(e=window)||null==(n=e.electronAPI)||n.sendMessage(i)}}),[t]);var i=r?r.slice(0,4)+"..."+r.slice(-4):"";return(0,y.jsxs)(M,{children:["Telegram:",i]})};var gt=["completedWizard","user"];(0,r.default)((function(){var e=(0,a.useReducer)((function(e){return e+1}),0),t=(0,o.default)(e,2),n=(t[0],t[1]),r=Z(),s=r.completedWizard,l=(r.user,(0,i.default)(r,gt)),u=(0,a.useState)(!1),c=(0,o.default)(u,2),d=c[0],f=c[1],h=(0,a.useState)(!1),p=(0,o.default)(h,2),m=p[0],g=p[1],v=(0,a.useState)({}),b=(0,o.default)(v,2),x=b[0],w=b[1];return(0,a.useEffect)((function(){return new dt(l).subscribe()}),[]),(0,a.useEffect)((function(){var e,t;null==(e=window)||null==(t=e.electronAPI)||t.onLoaderMessage((function(e){"completed"===e.log&&g(!0),w(e)})),window.electronAPI||setTimeout((function(){return g(100)}),3e3)}),[]),(0,a.useEffect)((function(){return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[n]),(0,y.jsxs)(z,{style:{flex:1},children:[(0,y.jsx)(q,{visible:!0,children:(0,y.jsxs)(z,{style:{flex:1,backgroundColor:D.app},children:[(0,y.jsxs)(z,{style:{flexDirection:"row",justifyContent:"space-between",paddingTop:10,paddingHorizontal:10},children:[!1,(0,y.jsx)(z,{}),(0,y.jsx)(U,{size:"20",icon:"settings",onClick:function(){return f(!0)}})]}),(0,y.jsxs)(z,{style:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",padding:10},children:[(0,y.jsx)(xe,{}),(0,y.jsx)(mt,{})]}),(0,y.jsx)(I,{color:D.textSecondary}),(0,y.jsx)(me,{})]})}),(0,y.jsx)(q,{visible:d,closeable:!0,onClose:function(){return f(!1)},children:(0,y.jsx)(Pe,{})}),(0,y.jsx)(q,{visible:!m,children:(0,y.jsx)(we,{report:x})}),(0,y.jsx)(q,{visible:!s,children:(0,y.jsx)(ce,{})})]})}))},3488:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/adan.70da22e81bd12a2391c9.png"},9234:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/eve.50e9f95f6dc36ff71f3b.png"},3052:()=>{},143:()=>{},2603:()=>{},7806:()=>{},2009:()=>{},6837:()=>{},2499:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,(()=>{var e=[];n.O=(t,r,i,o)=>{if(!r){var a=1/0;for(c=0;c<e.length;c++){for(var[r,i,o]=e[c],s=!0,l=0;l<r.length;l++)(!1&o||a>=o)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(s=!1,o<a&&(a=o));if(s){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,i,o]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>r[e]));return a.default=()=>r,n.d(o,a),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".3db6b82c.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web:";n.l=(r,i,o,a)=>{if(e[r])e[r].push(i);else{var s,l;if(void 0!==o)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[i];var f=(t,n)=>{s.onerror=s.onload=null,clearTimeout(h);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="./",(()=>{n.b=document.baseURI||self.location.href;var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}}),"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,r)=>{var i,o,[a,s,l]=r,u=0;if(a.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var c=l(n)}for(t&&t(r);u<a.length;u++)o=a[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(c)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n.O(void 0,[178],(()=>n(610)));r=n.O(r)})();
//# sourceMappingURL=main.a2a75ccf.js.map